<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UkrYama Reference: Yii EAuth extension</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UkrYama Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Створено системою Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Пошук');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Пошук');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespace_yii.html">Yii</a> <a class="el" href="class_e_auth.html">EAuth</a> extension </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Расширение <a class="el" href="class_e_auth.html">EAuth</a> позволяет добавить на сайт авторизацию с аккаунтов на других сайтах. Поддерживаемые протоколы: OpenID, OAuth 1.0 и OAuth 2.0.</p>
<p>Задачей расширения является предоставление единого (не зависящего от выбранного сервиса) метода авторизации пользователя. Таким образом, расширение самостоятельно не выполняет вход, не регистрирует пользователей и не связывает аккаунты пользователей от разных провайдеров.</p>
<h3>Почему собственное расширение, а не сторонний сервис?</h3>
<p>Реализация авторизации на стороне собственного сервиса имеет ряд преимуществ:</p>
<ul>
<li>Полный контроль над процессом авторизации: что будет написано в окне авторизации провайдера, какие данные мы получим и т.д.</li>
<li>Возможность изменять внешний вид виджета авторизации в соответствии с дизайном сайта.</li>
<li>При авторизации через OAuth есть возможность вызывать методы API, если их предоставляет провайдер.</li>
<li>Меньше зависимостей от сторонних сервисов – больше надежность.</li>
</ul>
<h3>Расширение позволяет:</h3>
<ul>
<li>Абстрагироваться от тонкостей авторизации через различные типы сервисов, использовать классы-адаптеры для каждого сервиса.</li>
<li>Получить уникальный идентификатор пользователя, который можно использовать для регистрации в вашем приложении.</li>
<li>Расширять стандартные классы авторизации для получения дополнительных данных о пользователе.</li>
<li>Работать с API социальных сетей путем расширения класса авторизации необходимого сервиса.</li>
<li>Настраивать список поддерживаемых сайтом сервисов, переопределять внешний вид виджета авторизации, использовать popup окно для авторизации без закрытия вашего приложения.</li>
</ul>
<h3>Расширение содержит:</h3>
<ul>
<li>Компонент, содержащий вспомогательные функции.</li>
<li>Виджет, выводящий список сервисов в виде иконок и позволяющий проводить авторизацию в popup окне.</li>
<li>Базовые классы для самостоятельного добавления новых сервисов.</li>
<li>Готовые классы для авторизации через Google, Twitter, Facebook и других провайдеров.</li>
</ul>
<h3>Поддерживаемые провайдеры "из коробки":</h3>
<ul>
<li>OpenID: Google, Яндекс</li>
<li>OAuth: Twitter, LinkedIn</li>
<li>OAuth 2.0: Google, Facebook, ВКонтакте, Mail.ru, GitHub, Live, Мой круг, Одноклассники</li>
</ul>
<h3>Ссылки</h3>
<ul>
<li><a href="https://github.com/Nodge/yii-eauth">Yii EAuth</a></li>
<li><a href="http://yiiframework.com/">Yii Framework</a></li>
<li><a href="http://openid.net/">OpenID</a></li>
<li><a href="http://oauth.net/">OAuth</a></li>
<li><a href="http://oauth.net/2/">OAuth 2.0</a></li>
<li><a href="http://www.yiiframework.com/extension/loid">loid extension</a></li>
<li><a href="http://www.yiiframework.com/extension/eoauth">EOAuth extension</a></li>
</ul>
<h3>Системные требования</h3>
<ul>
<li><a class="el" href="namespace_yii.html">Yii</a> 1.1 or above</li>
<li>PHP curl extension</li>
<li><a href="http://www.yiiframework.com/extension/loid">loid extension</a></li>
<li><a href="http://www.yiiframework.com/extension/eoauth">EOAuth extension</a></li>
</ul>
<h2>Установка</h2>
<ul>
<li>Установить расширения loid и EOAuth.</li>
<li>Распаковать расширение <a class="el" href="class_e_auth.html">EAuth</a> в директорию <code>protected/extensions</code>.</li>
<li>Добавить следующие строки в файл конфигурации <code>protected/config/main.php</code>:</li>
</ul>
<div class="fragment"><div class="line">&lt;?php</div><div class="line">...</div><div class="line">    <span class="stringliteral">&#39;import&#39;</span>=&gt;array(</div><div class="line">        <span class="stringliteral">&#39;ext.eoauth.*&#39;</span>,</div><div class="line">        <span class="stringliteral">&#39;ext.eoauth.lib.*&#39;</span>,</div><div class="line">        <span class="stringliteral">&#39;ext.lightopenid.*&#39;</span>,</div><div class="line">        <span class="stringliteral">&#39;ext.eauth.*&#39;</span>,</div><div class="line">        <span class="stringliteral">&#39;ext.eauth.services.*&#39;</span>,</div><div class="line">    ),</div><div class="line">...</div><div class="line">    <span class="stringliteral">&#39;components&#39;</span>=&gt;array(</div><div class="line">        <span class="stringliteral">&#39;loid&#39;</span> =&gt; array(</div><div class="line">            <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;ext.lightopenid.loid&#39;</span>,</div><div class="line">        ),</div><div class="line">        <span class="stringliteral">&#39;eauth&#39;</span> =&gt; array(</div><div class="line">            <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;ext.eauth.EAuth&#39;</span>,</div><div class="line">            <span class="stringliteral">&#39;popup&#39;</span> =&gt; <span class="keyword">true</span>, <span class="comment">// Использовать всплывающее окно вместо перенаправления на сайт провайдера</span></div><div class="line">            <span class="stringliteral">&#39;cache&#39;</span> =&gt; <span class="keyword">false</span>, <span class="comment">// Названия компнента для кеширования. False для отключения кеша. По умолчанию &#39;cache&#39;.</span></div><div class="line">            <span class="stringliteral">&#39;cacheExpire&#39;</span> =&gt; 0, <span class="comment">// Время жизни кеша. По умолчанию 0 - означает перманентное кеширование.</span></div><div class="line">            <span class="stringliteral">&#39;services&#39;</span> =&gt; array( <span class="comment">// Вы можете настроить список провайдеров и переопределить их классы</span></div><div class="line">                <span class="stringliteral">&#39;google&#39;</span> =&gt; array(</div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;GoogleOpenIDService&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;yandex&#39;</span> =&gt; array(</div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;YandexOpenIDService&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;twitter&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://dev.twitter.com/apps/new</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;TwitterOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;key&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;google_oauth&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://code.google.com/apis/console/</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;GoogleOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;Google (OAuth)&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;yandex_oauth&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://oauth.yandex.ru/client/my</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;YandexOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;Yandex (OAuth)&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;facebook&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://developers.facebook.com/apps/</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;FacebookOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;linkedin&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://www.linkedin.com/secure/developer</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;LinkedinOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;key&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;github&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://github.com/settings/applications</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;GitHubOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;live&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://manage.dev.live.com/Applications/Index</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;LiveOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;vkontakte&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: http://vk.com/editapp?act=create&amp;site=1</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;VKontakteOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;mailru&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: http://api.mail.ru/sites/my/add</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;MailruOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;moikrug&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: https://oauth.yandex.ru/client/my</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;MoikrugOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                ),</div><div class="line">                <span class="stringliteral">&#39;odnoklassniki&#39;</span> =&gt; array(</div><div class="line">                    <span class="comment">// регистрация приложения: http://dev.odnoklassniki.ru/wiki/pages/viewpage.action?pageId=13992188</span></div><div class="line">                    <span class="comment">// ... или здесь: http://www.odnoklassniki.ru/dk?st.cmd=appsInfoMyDevList&amp;st._aid=Apps_Info_MyDev</span></div><div class="line">                    http:<span class="comment">//dev.odnoklassniki.ru/wiki/pages/viewpage.action?pageId=13992188</span></div><div class="line">                    <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;OdnoklassnikiOAuthService&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_public&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;...&#39;</span>,</div><div class="line">                    <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;Однокл.&#39;</span>,</div><div class="line">                ),</div><div class="line">            ),</div><div class="line">        ),</div><div class="line">        ...</div><div class="line">    ),</div><div class="line">...</div></div><!-- fragment --><h2>Использование</h2>
<h4>Действие в контроллере</h4>
<div class="fragment"><div class="line">&lt;?php</div><div class="line">...</div><div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> actionLogin() {</div><div class="line">        $service = Yii::app()-&gt;request-&gt;getQuery(<span class="stringliteral">&#39;service&#39;</span>);</div><div class="line">        <span class="keywordflow">if</span> (isset($service)) {</div><div class="line">            $authIdentity = Yii::app()-&gt;eauth-&gt;getIdentity($service);</div><div class="line">            $authIdentity-&gt;redirectUrl = Yii::app()-&gt;user-&gt;returnUrl;</div><div class="line">            $authIdentity-&gt;cancelUrl = $this-&gt;createAbsoluteUrl(<span class="stringliteral">&#39;site/login&#39;</span>);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> ($authIdentity-&gt;authenticate()) {</div><div class="line">                $identity = <span class="keyword">new</span> <a class="code" href="class_e_auth_user_identity.html">EAuthUserIdentity</a>($authIdentity);</div><div class="line"></div><div class="line">                <span class="comment">// успешная авторизация</span></div><div class="line">                <span class="keywordflow">if</span> ($identity-&gt;authenticate()) {</div><div class="line">                    Yii::app()-&gt;user-&gt;login($identity);</div><div class="line"></div><div class="line">                    <span class="comment">// специальное перенаправления для корректного закрытия всплывающего окна</span></div><div class="line">                    $authIdentity-&gt;redirect();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> {</div><div class="line">                    <span class="comment">// закрытие всплывающего окна и перенаправление на cancelUrl</span></div><div class="line">                    $authIdentity-&gt;cancel();</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment">// авторизация не удалась, перенаправляем на страницу входа</span></div><div class="line">            $this-&gt;redirect(array(<span class="stringliteral">&#39;site/login&#39;</span>));</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// далее стандартный код авторизации по логину/паролю...</span></div><div class="line">    }</div></div><!-- fragment --><h4>Представление</h4>
<div class="fragment"><div class="line">&lt;h2&gt;Нажмите на иконку для входа через один из сайтов:&lt;/h2&gt;</div><div class="line">&lt;?php</div><div class="line">    $this-&gt;widget(<span class="stringliteral">&#39;ext.eauth.EAuthWidget&#39;</span>, array(<span class="stringliteral">&#39;action&#39;</span> =&gt; <span class="stringliteral">&#39;site/login&#39;</span>));</div><div class="line">?&gt;</div></div><!-- fragment --><h4>Получение дополнительных данных (не обязательно)</h4>
<p>Чтобы получать все необходимые Вашему приложению данные, Вы можете переопределить базовый класс любого провайдера. Базовые классы хранятся в <code>protected/extensions/eauth/services/</code>. Примеры расширенных классов можно посмотреть в <code>protected/extensions/eauth/custom_services/</code>.</p>
<p>После переопределения базового класса, необходимо поправить Ваш файл конфигурации, указав новое имя класса. Возможно, Вам понадобится переопределить <code><a class="el" href="class_e_auth_user_identity.html">EAuthUserIdentity</a></code> для сохранения дополнительных данных.</p>
<h4>Перевод сообщений (не обязательно)</h4>
<ul>
<li>Для перевода <a class="el" href="class_e_auth.html">EAuth</a> на другие языки скопируйте файл <code>/protected/extensions/eauth/messages/[lang]/eauth.php</code> в <code>/protected/messages/[lang]/eauth.php</code>, где [lang] - код необходимого языка.</li>
<li>Если в <code>/protected/extensions/eauth/messages/</code> нет нужного Вам языка, можно воспользоваться файлом <code>/protected/extensions/eauth/messages/blank/eauth.php</code> для перевода расширения на другие языки.</li>
</ul>
<h2>Лицензия</h2>
<p>Некоторое время назад я разработал данное расширение для своего проекта <a href="http://listick.ru">LiStick.ru</a>. На данный момент я продолжаю поддерживать расширение.</p>
<p>Расширение предоставляется под лицензией <a href="http://www.opensource.org/licenses/bsd-license.php">New BSD License</a>, так что последнюю версию можно найти на <a href="https://github.com/Nodge/yii-eauth">GitHub</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Створено системою &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
